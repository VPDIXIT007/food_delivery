{{ header }}
<style>#option fieldset {
    padding: 1px;
}</style>
<div class="pts-container container">
    <select name="store_id" id="input-store" class="form-control">
    <option value="0" selected="selected">{{ store.name }}</option>
	</select>
<div class="pts-row d-flex row">{{ column_left }}
		<div id="content" class="pts-col-sm-9 col-sm-9 pts-col-md-9 col-md-9 pts-col-lg-10 col-lg-10 pts-col-xs-12 col-xs-12"> 
			<div class="page-header">
    {% if success %}
    <div class="alert pts-alert-success"><i class="fa fa-check-circle"></i> {{ success }}</div>
    {% endif %}
    <div class="container-fluid">
     <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
	  {% for breadcrumb in breadcrumbs %}
                <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
				{% endfor %}
              </ul>
			  <div class="pull-right float-right"><a href="{{ invoice }}" target="_blank" data-toggle="tooltip" title="{{ button_invoice_print }}" class="pts-btn pts-btn-info"><i class="fa fa-print"></i></a> <a href="{{ shipping }}" target="_blank" data-toggle="tooltip" title="{{ button_shipping_print }}" class="pts-btn pts-btn-info"><i class="fa fa-truck"></i></a></div>
    </div>
  </div>
			<div class="pts-row">
				<div class="pts-col-md-6">
					<div class="pts-panel pts-panel-default">
						<div class="pts-panel-heading">
							<h3 class="pts-panel-title"><i class="fa fa-shopping-cart"></i> {{ text_order_detail }}</h3>
						</div>
						<table class="pts-table">
							<tbody>
								<tr>
									<td style="width: 1%;"><button data-toggle="tooltip" title="{{ text_store }}" class="pts-btn pts-btn-info pts-btn-xs"><i class="fa fa-shopping-cart fa-fw"></i></button></td>
									<td><a href="{{ store_url }}" target="_blank">{{ store_name }}</a></td>
								</tr>
								<tr>
									<td><button data-toggle="tooltip" title="{{ text_date_added }}" class="pts-btn pts-btn-info pts-btn-xs"><i class="fa fa-calendar fa-fw"></i></button></td>
									<td>{{ date_added }}</td>
								</tr>
								<tr>
									<td><button data-toggle="tooltip" title="{{ text_payment_method }}" class="pts-btn pts-btn-info pts-btn-xs"><i class="fa fa-credit-card fa-fw"></i></button></td>
									<td>{{ payment_method }}</td>
								</tr>
								{% if shipping_method %}
								<tr>
									<td><button data-toggle="tooltip" title="{{ text_shipping_method }}" class="pts-btn pts-btn-info pts-btn-xs"><i class="fa fa-truck fa-fw"></i></button></td>
									<td>{{ shipping_method }}</td>
								</tr>
								{% endif %}
							</tbody>
						</table>
					</div>
				</div>
				<div class="pts-col-md-6">
					<div class="pts-panel pts-panel-default">
						<div class="pts-panel-heading">
							<h3 class="pts-panel-title"><i class="fa fa-user"></i> {{ text_customer_detail }}</h3>
						</div>
						<table class="pts-table">
							<tr>
								<td style="width: 1%;"><button data-toggle="tooltip" title="{{ text_customer }}" class="pts-btn pts-btn-info pts-btn-xs"><i class="fa fa-user fa-fw"></i></button></td>
								<td>{% if customer %}
									{{ firstname }} {{ lastname }}
									{% else %}
									{{ firstname }} {{ lastname }}
								{% endif %}</td>
							</tr>
							<tr>
								<td><button data-toggle="tooltip" title="{{ text_customer_group }}" class="pts-btn pts-btn-info pts-btn-xs"><i class="fa fa-group fas fa-users fa-fw"></i></button></td>
								<td>{{ customer_group }}</td>
							</tr>
							<tr>
								<td><button data-toggle="tooltip" title="{{ text_email }}" class="pts-btn pts-btn-info pts-btn-xs"><i class="fa fa-envelope-o far fa-envelope fa-fw"></i></button></td>
								<td><a href="mailto:{{ email }}">{{ email }}</a></td>
							</tr>
							<tr>
								<td><button data-toggle="tooltip" title="{{ text_telephone }}" class="pts-btn pts-btn-info pts-btn-xs"><i class="fa fa-phone fa-fw"></i></button></td>
								<td>{{ telephone }}</td>
							</tr>
						</table>
					</div>
				</div>
				
			</div>
			<div class="pts-panel pts-panel-default">
				<div class="pts-panel-heading">
					<h3 class="pts-panel-title"><i class="fa fa-info-circle"></i> {{ text_order }}</h3>
				</div>
				<div class="pts-panel-body">
					<table class="pts-table pts-table-bordered">
						<thead>
							<tr>
								<td style="width: 50%;" class="pts-text-left">{{ text_payment_address }}</td>
								{% if shipping_method %}
								<td style="width: 50%;" class="pts-text-left">{{ text_shipping_address }}</td>
								{% endif %}
							</tr>
						</thead>
						<tbody>
							<tr>
								<td class="pts-text-left">{{ payment_address }}</td>
								{% if shipping_method %}
								<td class="pts-text-left">{{ shipping_address }}</td>
								{% endif %}
							</tr>
						</tbody>
					</table>
					<!--<table class="pts-table pts-table-bordered">
							<thead>
							<tr>
								<td class="pts-text-left">{{ column_product }}</td>
								<td class="pts-text-left">{{ column_model }}</td>
								<td class="pts-text-left">{{ column_comment }}</td>
								<td class="pts-text-right">{{ column_quantity }}</td>
								<td class="pts-text-right">{{ column_price }}</td>
								<td class="pts-text-right">{{ column_total }}</td>
							</tr>
						</thead>
					<tbody> -->
						 <div class="tab-pane" id="tab-cart">
              <div class="table-responsive">
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <td class="text-left">{{ column_product }}</td>
                
                      <td class="text-right">{{ column_quantity }}</td>
					  <td class="pts-text-left">{{ column_comment }}</td>
                      <td class="text-right">{{ column_price }}</td>
                      <td class="text-right">{{ column_total }}</td>
                      <td>{{ column_action }}</td>
                    </tr>
                  </thead>
                  <tbody id="cart">
                    {% if products or order_vouchers %}
                    {% set product_row = 0 %}
                    {% for product in products %}
                    <tr>
                      <td class="text-left">{{ product.name }}<br />
                        <input type="hidden" name="product[{{ product_row }}][product_id]" value="{{ product.product_id }}" />
                        {% for option in product.option %}
                        - <small>{{ option.name }}: {{ option.value }}</small><br />
                        {% if option.type == 'select' or option.type == 'radio' or option.type == 'image' %}
                        <input type="hidden" name="product[{{ product_row }}][option][{{ option.product_option_id }}]" value="{{ option.product_option_value_id }}" />
                        {% endif %}
                        {% if option.type == 'checkbox' %}
                        <input type="hidden" name="product[{{ product_row }}][option][{{ option.product_option_id }}][]" value="{{ option.product_option_value_id }}" />
                        {% endif %}
                        {% if option.type == 'text' or option.type == 'textarea' or option.type == 'file' or option.type == 'date' or option.type == 'datetime' or option.type == 'time' %}
                        <input type="hidden" name="product[{{ product_row }}][option][{{ option.product_option_id }}]" value="{{ option.value }}" />
                        {% endif %}
                        {% endfor %}</td>
                   

						<td class="text-right"><div class="input-group btn-block" style="max-width: 200px;">
						<input type="text" name="product[{{ product_row }}][quantity]" value="{{ product.quantity }}" class="form-control" /><span class="input-group-btn"><button type="button" data-toggle="tooltip" title="{{ button_refresh }}" data-loading-text="{{ text_loading }}" class="btn btn-primary"><i class="fa fa-refresh"></i></button></span></div></td>
               
						<td class="pts-text-left">{{ product.pcomment }}</td>
                      <td class="text-right">{{product.price}}</td>
                      <td class="text-right">{{ product.total }}</td>
                        <td class="text-center" style="width: 3px;"><button type="button" value="{{ product.product_id }}" data-toggle="tooltip" title="{{ button_remove }}" data-loading-text="{{ text_loading }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>
				
                    </tr>
                    {% set product_row = product_row + 1 %}
                    {% endfor %}
                    {% set voucher_row = 0 %}
                    {% for order_voucher in order_vouchers %}
                    <tr>
                      <td class="text-left">{{ order_voucher.description }}
                        <input type="hidden" name="voucher[{{ voucher_row }}][voucher_id]" value="{{ order_voucher.voucher_id }}" />
                        <input type="hidden" name="voucher[{{ voucher_row }}][description]" value="{{ order_voucher.description }}" />
                        <input type="hidden" name="voucher[{{ voucher_row }}][code]" value="{{ order_voucher.code }}" />
                        <input type="hidden" name="voucher[{{ voucher_row }}][from_name]" value="{{ order_voucher.from_name }}" />
                        <input type="hidden" name="voucher[{{ voucher_row }}][from_email]" value="{{ order_voucher.from_email }}" />
                        <input type="hidden" name="voucher[{{ voucher_row }}][to_name]" value="{{ order_voucher.to_name }}" />
                        <input type="hidden" name="voucher[{{ voucher_row }}][to_email]" value="{{ order_voucher.to_email }}" />
                        <input type="hidden" name="voucher[{{ voucher_row }}][voucher_theme_id]" value="{{ order_voucher.voucher_theme_id }}" />
                        <input type="hidden" name="voucher[{{ voucher_row }}][message]" value="{{ order_voucher.message }}" />
                        <input type="hidden" name="voucher[{{ voucher_row }}][amount]" value="{{ order_voucher.amount }}" /></td>
                      <td class="text-left"></td>
                      <td class="text-right">1</td>
                      <td class="text-right"></td>
                      <td class="text-right"></td>
                      <td class="text-center"></td>
                    </tr>
                    {% set voucher_row = voucher_row + 1 %}
                    {% endfor %}
                    {% else %}
                    <tr>
                      <td class="text-center" colspan="6">{{ text_no_results }}</td>
                    </tr>
                  </tbody>
                  {% endif %}
                </table>
              </div>
             
              <div class="tab-content">
                <div class="tab-pane active" id="tab-product">
                  <fieldset>
                    <legend>{{ text_product }}</legend>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="input-product">{{ entry_product }}</label>
                      <div class="col-sm-10">
                        <input type="text" name="product" value="" id="input-product" class="form-control" />
                        <input type="hidden" name="product_id" value="" />
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="input-quantity">{{ entry_quantity }}</label>
                      <div class="col-sm-10">
                        <input type="text" name="quantity" value="1" id="input-quantity" class="form-control" />
                      </div>
                    </div>
                    <div id="option"></div>
                  </fieldset>
                  <div class="text-right">
                    <button type="button" id="button-product-add" data-loading-text="{{ text_loading }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i> {{ button_product_add }}</button>
                  </div>
                </div>
                <div class="tab-pane" id="tab-voucher">
                  <fieldset>
                    <legend>{{ text_voucher }}</legend>
                    <div class="form-group required">
                      <label class="col-sm-2 control-label" for="input-to-name">{{ entry_to_name }}</label>
                      <div class="col-sm-10">
                        <input type="text" name="to_name" value="" id="input-to-name" class="form-control" />
                      </div>
                    </div>
                    <div class="form-group required">
                      <label class="col-sm-2 control-label" for="input-to-email">{{ entry_to_email }}</label>
                      <div class="col-sm-10">
                        <input type="text" name="to_email" value="" id="input-to-email" class="form-control" />
                      </div>
                    </div>
                    <div class="form-group required">
                      <label class="col-sm-2 control-label" for="input-from-name">{{ entry_from_name }}</label>
                      <div class="col-sm-10">
                        <input type="text" name="from_name" value="" id="input-from-name" class="form-control" />
                      </div>
                    </div>
                    <div class="form-group required">
                      <label class="col-sm-2 control-label" for="input-from-email">{{ entry_from_email }}</label>
                      <div class="col-sm-10">
                        <input type="text" name="from_email" value="" id="input-from-email" class="form-control" />
                      </div>
                    </div>
                    <div class="form-group required">
                      <label class="col-sm-2 control-label" for="input-theme">{{ entry_theme }}</label>
                      <div class="col-sm-10">
                        <select name="voucher_theme_id" id="input-theme" class="form-control">
                          {% for voucher_theme in voucher_themes %}
                          <option value="{{ voucher_theme.voucher_theme_id }}">{{ voucher_theme.name }}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="input-message">{{ entry_message }}</label>
                      <div class="col-sm-10">
                        <textarea name="message" rows="5" id="input-message" class="form-control"></textarea>
                      </div>
                    </div>
                    <div class="form-group required">
                      <label class="col-sm-2 control-label" for="input-amount">{{ entry_amount }}</label>
                      <div class="col-sm-10">
                        <input type="text" name="amount" value="{{ voucher_min }}" id="input-amount" class="form-control" />
                      </div>
                    </div>
                  </fieldset>
                  <div class="text-right">
                    <button type="button" id="button-voucher-add" data-loading-text="{{ text_loading }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i> {{ button_voucher_add }}</button>
                  </div>
                </div>
              </div>
              <br />
             
            </div>
							<!--{% for product in products %}
							<tr>
								<td class="pts-text-left"><a href="{{ product['href'] }}" target="_blank">{{ product.name }}</a>
									{% for option in product.option %}
									<br />
									{% if option.type != 'file' %}
									&nbsp;<small> - {{ option.name }}: {{ option.value }}</small>
									{% else %}
									&nbsp;<small> - {{ option.name }}: <a href="{{ option.href }}">{{ option.value }}</a></small>
									{% endif %}
								{% endfor %}</td>
								<td class="pts-text-left">{{ product.model }}</td>
								<td class="pts-text-left">{{ product.pcomment }}</td>
								<td class="pts-text-right">{{ product.quantity }}</td>
								<td class="pts-text-right">{{ product.price }}</td>
								<td class="pts-text-right">{{ product.total }}</td>
							</tr>
							{% endfor %}
							{% for voucher in vouchers %}
							<tr>
								<td class="pts-text-left"><a href="{{ voucher.href }}">{{ voucher.description }}</a></td>
								<td class="pts-text-left"></td>
								<td class="pts-text-right">1</td>
								<td class="pts-text-right">{{ voucher.amount }}</td>
								<td class="pts-text-right">{{ voucher.amount }}</td>
							</tr>
							{% endfor %}
							{% for total in totals %}
							<tr>
								<td colspan="4" class="pts-text-right">{{ total.title }}</td>
								<td class="pts-text-right">{{ total.text }}</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>-->
					{% if comment %}
					<table class="pts-table pts-table-bordered">
						<thead>
							<tr>
								<td>{{ text_comment }}</td>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>{{ comment }}</td>
							</tr>
						</tbody>
					</table>
					{% endif %}
				</div>
			</div>
			<div class="pts-panel pts-panel-default">
				<div class="pts-panel-heading">
					<h3 class="pts-panel-title"><i class="fa fa-comment-o"></i> {{ text_history }}</h3>
				</div>
				<div class="pts-panel-body">
					<ul class="pts-nav pts-nav-tabs">
						<li class="active"><a href="#tab-history" data-toggle="tab">{{ tab_history }}</a></li>
						{% for tab in tabs %}
						<li><a href="#tab-{{ tab.code }}" data-toggle="tab">{{ tab.title }}</a></li>
						{% endfor %}
					</ul>
					<div class="tab-pts-content">
						<div class="pts-tab-pane active" id="tab-history">
							<div id="history"></div>
							<br />
							{% if manage_order %}
							<fieldset>
								<legend>{{ text_history_add }}</legend>
								<form class="pts-form-horizontal">
									<div class="pts-form-group">
										<label class="pts-col-sm-2 pts-control-label" for="input-order-status">{{ entry_order_status }}</label>
										<div class="pts-col-sm-10">
											<select {% if module_purpletree_multivendor_commission_status == admin_order_status_id %} disabled {% else %} name="order_status_id" {% endif %}id="input-order-status" class="pts-form-control">
												{% for order_statuses in order_statuses %}
												{% if order_statuses.order_status_id == order_status_id %}
												<option value="{{ order_statuses.order_status_id }}" selected="selected">{{ order_statuses.name }}</option>
												{% else %}
												<option value="{{ order_statuses.order_status_id }}">{{ order_statuses.name }}</option>
												{% endif %}
												{% endfor %}
											</select>
										</div>
									</div>
									<div class="pts-form-group">
										<label class="pts-col-sm-2 pts-control-label" for="input-override"><span data-toggle="tooltip" title="{{ help_override }}">{{ entry_override }}</span></label>
										<div class="pts-col-sm-10">
											<input type="checkbox" {% if module_purpletree_multivendor_commission_status == admin_order_status_id %} disabled {% else %} name="override" value="1" {% endif %} id="input-override" />
										</div>
									</div>
									<div class="pts-form-group">
										<label class="pts-col-sm-2 pts-control-label" for="input-notify">{{ entry_notify }}</label>
										<div class="pts-col-sm-10">
											<input type="checkbox" {% if module_purpletree_multivendor_commission_status == admin_order_status_id %} disabled {% else %} name="notify" value="1" {% endif %}  id="input-notify" />
										</div>
									</div>
									<div class="pts-form-group">
										<label class="pts-col-sm-2 pts-control-label" for="input-comment">{{ entry_comment }}</label>
										<div class="pts-col-sm-10">
											<textarea {% if module_purpletree_multivendor_commission_status == admin_order_status_id %} disabled {% else %} name="comment" {% endif %} rows="8" id="input-comment" class="pts-form-control"></textarea>
										</div>
									</div>
								</form>
							</fieldset>
							<div class="pts-text-right">
								<button {% if module_purpletree_multivendor_commission_status == admin_order_status_id %} disabled {% endif %} id="pts-button-history" data-loading-text="{{ text_loading }}" class="pts-btn pts-btn-primary"><i class="fa fa-plus-circle"></i> {{ button_history_add }}</button>
							</div>
							{% endif %}
						</div>
						<div class="pts-tab-pane" id="pts-tab-additional">
							{% if account_custom_fields %}
							<div class="pts-table-responsive">
								<table class="pts-table pts-table-bordered">
									<thead>
										<tr>
											<td colspan="2">{{ text_account_custom_field }}</td>
										</tr>
									</thead>
									<tbody>
										{% for custom_field in account_custom_fields %}
										<tr>
											<td>{{ custom_field.name }}</td>
											<td>{{ custom_field.value }}</td>
										</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
							{% endif %}
							{% if payment_custom_fields %}
							<div class="pts-table-responsive">
								<table class="pts-table pts-table-bordered">
									<thead>
										<tr>
											<td colspan="2">{{ text_payment_custom_field }}</td>
										</tr>
									</thead>
									<tbody>
										{% for custom_field in payment_custom_fields %}
										<tr>
											<td>{{ custom_field.name }}</td>
											<td>{{ custom_field.value }}</td>
										</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
							{% endif %}
							{% if shipping_method and shipping_custom_fields %}
							<div class="pts-table-responsive">
								<table class="pts-table pts-table-bordered">
									<thead>
										<tr>
											<td colspan="2">{{ text_shipping_custom_field }}</td>
										</tr>
									</thead>
									<tbody>
										{% for custom_field in shipping_custom_fields %}
										<tr>
											<td>{{ custom_field.name }}</td>
											<td>{{ custom_field.value }}</td>
										</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
							{% endif %}
						</div>
					</div>
					{% for tab in tabs %}
					<div class="pts-tab-pane" id="tab-{{ tab.code }}">{{ tab.content }}</div>
					{% endfor %}
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript"><!--
	$('#tab-product input[name=\'product\']').autocomplete({
	
	'source': function(request, response) {
	
		$.ajax({
			url: 'index.php?route=catalog/product/autocomplete&filter_name=' +  encodeURIComponent(request),
			dataType: 'json',
			success: function(json) {
				response($.map(json, function(item) {
					return {
						label: item['name'],
						value: item['product_id'],
						model: item['model'],
						option: item['option'],
						price: item['price']
					}
				}));
			}
		});
	},
	'select': function(item) {
		//alert(item['label']);
		$('#tab-product input[name=\'product\']').val(item['label']);
		$('#tab-product input[name=\'product_id\']').val(item['value']);
		
		 if (item['option'] != '') {
 			html  = '<fieldset>';
            html += '  <legend>{{ entry_option }}</legend>';

			for (i = 0; i < item['option'].length; i++) {
				option = item['option'][i];

				if (option['type'] == 'select') {
					html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
					html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
					html += '  <div class="col-sm-10">';
					html += '    <select name="option[' + option['product_option_id'] + ']" id="input-option' + option['product_option_id'] + '" class="form-control">';
					html += '      <option value="">{{ text_select }}</option>';

					for (j = 0; j < option['product_option_value'].length; j++) {
						option_value = option['product_option_value'][j];

						html += '<option value="' + option_value['product_option_value_id'] + '">' + option_value['name'];

						if (option_value['price']) {
							html += ' (' + option_value['price_prefix'] + option_value['price'] + ')';
						}

						html += '</option>';
					}

					html += '    </select>';
					html += '  </div>';
					html += '</div>';
				}

				if (option['type'] == 'radio') {
					html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
					html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
					html += '  <div class="col-sm-10">';
					html += '    <select name="option[' + option['product_option_id'] + ']" id="input-option' + option['product_option_id'] + '" class="form-control">';
					html += '      <option value="">{{ text_select }}</option>';

					for (j = 0; j < option['product_option_value'].length; j++) {
						option_value = option['product_option_value'][j];

						html += '<option value="' + option_value['product_option_value_id'] + '">' + option_value['name'];

						if (option_value['price']) {
							html += ' (' + option_value['price_prefix'] + option_value['price'] + ')';
						}

						html += '</option>';
					}

					html += '    </select>';
					html += '  </div>';
					html += '</div>';
				}

				if (option['type'] == 'checkbox') {
					html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
					html += '  <label class="col-sm-2 control-label">' + option['name'] + '</label>';
					html += '  <div class="col-sm-10">';
					html += '    <div id="input-option' + option['product_option_id'] + '">';

					for (j = 0; j < option['product_option_value'].length; j++) {
						option_value = option['product_option_value'][j];

						html += '<div class="checkbox">';

						html += '  <label><input type="checkbox" name="option[' + option['product_option_id'] + '][]" value="' + option_value['product_option_value_id'] + '" /> ' + option_value['name'];

						if (option_value['price']) {
							html += ' (' + option_value['price_prefix'] + option_value['price'] + ')';
						}

						html += '  </label>';
						html += '</div>';
					}

					html += '    </div>';
					html += '  </div>';
					html += '</div>';
				}

				if (option['type'] == 'image') {
					html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
					html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
					html += '  <div class="col-sm-10">';
					html += '    <select name="option[' + option['product_option_id'] + ']" id="input-option' + option['product_option_id'] + '" class="form-control">';
					html += '      <option value="">{{ text_select }}</option>';

					for (j = 0; j < option['product_option_value'].length; j++) {
						option_value = option['product_option_value'][j];

						html += '<option value="' + option_value['product_option_value_id'] + '">' + option_value['name'];

						if (option_value['price']) {
							html += ' (' + option_value['price_prefix'] + option_value['price'] + ')';
						}

						html += '</option>';
					}

					html += '    </select>';
					html += '  </div>';
					html += '</div>';
				}

				if (option['type'] == 'text') {
					html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
					html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
					html += '  <div class="col-sm-10"><input type="text" name="option[' + option['product_option_id'] + ']" value="' + option['value'] + '" id="input-option' + option['product_option_id'] + '" class="form-control" /></div>';
					html += '</div>';
				}

				if (option['type'] == 'textarea') {
					html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
					html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
					html += '  <div class="col-sm-10"><textarea name="option[' + option['product_option_id'] + ']" rows="5" id="input-option' + option['product_option_id'] + '" class="form-control">' + option['value'] + '</textarea></div>';
					html += '</div>';
				}

				if (option['type'] == 'file') {
					html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
					html += '  <label class="col-sm-2 control-label">' + option['name'] + '</label>';
					html += '  <div class="col-sm-10">';
					html += '    <button type="button" id="button-upload' + option['product_option_id'] + '" data-loading-text="{{ text_loading }}" class="btn btn-default"><i class="fa fa-upload"></i> {{ button_upload }}</button>';
					html += '    <input type="hidden" name="option[' + option['product_option_id'] + ']" value="' + option['value'] + '" id="input-option' + option['product_option_id'] + '" />';
					html += '  </div>';
					html += '</div>';
				}

				if (option['type'] == 'date') {
					html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
					html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
					html += '  <div class="col-sm-3"><div class="input-group date"><input type="text" name="option[' + option['product_option_id'] + ']" value="' + option['value'] + '" placeholder="' + option['name'] + '" data-date-format="YYYY-MM-DD" id="input-option' + option['product_option_id'] + '" class="form-control" /><span class="input-group-btn"><button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button></span></div></div>';
					html += '</div>';
				}

				if (option['type'] == 'datetime') {
					html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
					html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
					html += '  <div class="col-sm-3"><div class="input-group datetime"><input type="text" name="option[' + option['product_option_id'] + ']" value="' + option['value'] + '" placeholder="' + option['name'] + '" data-date-format="YYYY-MM-DD HH:mm" id="input-option' + option['product_option_id'] + '" class="form-control" /><span class="input-group-btn"><button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button></span></div></div>';
					html += '</div>';
				}

				if (option['type'] == 'time') {
					html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
					html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
					html += '  <div class="col-sm-3"><div class="input-group time"><input type="text" name="option[' + option['product_option_id'] + ']" value="' + option['value'] + '" placeholder="' + option['name'] + '" data-date-format="HH:mm" id="input-option' + option['product_option_id'] + '" class="form-control" /><span class="input-group-btn"><button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button></span></div></div>';
					html += '</div>';
				}
			}

			html += '</fieldset>';

			$('#option').html(html);

			$('.date').datetimepicker({
				language: '{{ datepicker }}',
				pickTime: false
			});

			$('.datetime').datetimepicker({
				language: '{{ datepicker }}',
				pickDate: true,
				pickTime: true
			});

			$('.time').datetimepicker({
				language: '{{ datepicker }}',
				pickDate: false
			});
		} else {
			$('#option').html('');
		} 
	}
});

$('#button-product-add').on('click', function() {
	$.ajax({
		url: '{{ catalog }}index.php?route=catalog/product/addproduct&order_id={{ order_id }}&store_id=' + $('select[name=\'store_id\'] option:selected').val(),
		type: 'post',
		data: $('#tab-product input[name=\'product_id\'], #tab-product input[name=\'quantity\'], #tab-product input[name^=\'option\'][type=\'text\'], #tab-product input[name^=\'option\'][type=\'hidden\'], #tab-product input[name^=\'option\'][type=\'radio\']:checked, #tab-product input[name^=\'option\'][type=\'checkbox\']:checked, #tab-product select[name^=\'option\'], #tab-product textarea[name^=\'option\']'),
		dataType: 'json',
		crossDomain: true,
		beforeSend: function() {
			$('#button-product-add').button('loading');
		},
		complete: function() {
			$('#button-product-add').button('reset');
		},
		success: function(json) {
			$('.alert-dismissible, .text-danger').remove();
			$('.form-group').removeClass('has-error');

			if (json['error']) {
				if (json['error']['warning']) {
					$('#content > .container-fluid').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
				}

				if (json['error']['option']) {
					for (i in json['error']['option']) {
						var element = $('#input-option' + i.replace('_', '-'));

						if (element.parent().hasClass('input-group')) {
							$(element).parent().after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
						} else {
							$(element).after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
						}
					}
				}

				if (json['error']['store']) {
					$('#content > .container-fluid').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error']['store'] + '</div>');
				}

				// Highlight any found errors
				$('.text-danger').parentsUntil('.form-group').parent().addClass('has-error');
			} else {
				// Refresh products, vouchers and totals
				$('#button-refresh').trigger('click');
			}
			   location.reload();
		},
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
	});
});

// Voucher
$('#button-voucher-add').on('click', function() {
	$.ajax({
		url: '{{ catalog }}index.php?route=api/voucher/add&api_token={{ api_token }}&store_id=' + $('select[name=\'store_id\'] option:selected').val(),
		type: 'post',
		data: $('#tab-voucher input[type=\'text\'], #tab-voucher input[type=\'hidden\'], #tab-voucher input[type=\'radio\']:checked, #tab-voucher input[type=\'checkbox\']:checked, #tab-voucher select, #tab-voucher textarea'),
		dataType: 'json',
		crossDomain: true,
		beforeSend: function() {
			$('#button-voucher-add').button('loading');
		},
		complete: function() {
			$('#button-voucher-add').button('reset');
		},
		success: function(json) {
			$('.alert-dismissible, .text-danger').remove();
			$('.form-group').removeClass('has-error');

			if (json['error']) {
				if (json['error']['warning']) {
					$('#content > .container-fluid').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
				}

				for (i in json['error']) {
					var element = $('#input-' + i.replace('_', '-'));

					if (element.parent().hasClass('input-group')) {
						$(element).parent().after('<div class="text-danger">' + json['error'][i] + '</div>');
					} else {
						$(element).after('<div class="text-danger">' + json['error'][i] + '</div>');
					}
				}

				// Highlight any found errors
				$('.text-danger').parentsUntil('.form-group').parent().addClass('has-error');
			} else {
				$('input[name=\'from_name\']').val('');
				$('input[name=\'from_email\']').val('');
				$('input[name=\'to_name\']').val('');
				$('input[name=\'to_email\']').val('');
				$('textarea[name=\'message\']').val('');
				$('input[name=\'amount\']').val('{{ voucher_min|escape('js') }}');

				// Refresh products, vouchers and totals
				$('#button-refresh').trigger('click');
			}
		},
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
	});
});

$('#cart').delegate('.btn-danger', 'click', function() {
	var node = this;

	$.ajax({
		url: '{{ catalog }}index.php?route=catalog/product/removeproduct&order_id={{ order_id }}&store_id=' + $('select[name=\'store_id\'] option:selected').val(),
		type: 'post',
		data: 'key=' + encodeURIComponent(this.value),
		dataType: 'json',
		crossDomain: true,
		beforeSend: function() {
			$(node).button('loading');
		},
		complete: function() {
			$(node).button('reset');
		},
		success: function(json) {
			$('.alert-dismissible, .text-danger').remove();

			// Check for errors
			if (json['error']) {
				$('#content > .container-fluid').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
			} else {
				// Refresh products, vouchers and totals
				$('#button-refresh').trigger('click');
			}
			   location.reload();
		},
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
	});
});

$('#cart').delegate('.btn-primary', 'click', function() {
    var node = this;

    // Refresh products, vouchers and totals
    $.ajax({
        url: '{{ catalog }}index.php?route=catalog/product/refreshquantity&order_id={{ order_id }}&store_id=' + $('select[name=\'store_id\'] option:selected').val(),
        type: 'post',
        data: $('#cart input[name^=\'product\'][type=\'text\'], #cart input[name^=\'product\'][type=\'hidden\'], #cart input[name^=\'product\'][type=\'radio\']:checked, #cart input[name^=\'product\'][type=\'checkbox\']:checked, #cart select[name^=\'product\'], #cart textarea[name^=\'product\']'),
        dataType: 'json',
        crossDomain: true,
        beforeSend: function() {
            $(node).button('loading');
        },
        complete: function() {
            $(node).button('reset');
        },
        success: function(json) {
            $('.alert-dismissible, .text-danger').remove();
            $('.form-group').removeClass('has-error');

            if (json['error'] && json['error']['warning']) {
                $('#content > .container-fluid').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
            }

            if (json['success']) {
				$('#content > .container-fluid').prepend('<div class="alert alert-success alert-dismissible"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
			  location.reload();
			}
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    }).done(function() {
        $('#button-refresh').trigger('click');
    });
});

$('#button-cart').on('click', function() {
	$('a[href=\'#tab-payment\']').tab('show');
});

	$(document).delegate('#pts-button-invoice', 'click', function() {
		$.ajax({
			url: 'index.php?route=sale/order/createinvoiceno&order_id={{ order_id }}',
			dataType: 'json',
			beforeSend: function() {
				$('#button-invoice').button('loading');
			},
			complete: function() {
				$('#button-invoice').button('reset');
			},
			success: function(json) {
				$('.alert').remove();
				
				if (json['error']) {
					$('#pts-content > .pts-container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + '</div>');
				}
				
				if (json['invoice_no']) {
					$('#invoice').html(json['invoice_no']);
					
					$('#button-invoice').replaceWith('<button disabled="disabled" class="pts-btn pts-btn-success pts-btn-xs"><i class="fa fa-cog"></i></button>');
				}
			},
			error: function(xhr, ajaxOptions, thrownError) {
				alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
			}
		});
	});
	
	$(document).delegate('#button-reward-add', 'click', function() {
		$.ajax({
			url: 'index.php?route=sale/order/addreward&order_id={{ order_id }}',
			type: 'post',
			dataType: 'json',
			beforeSend: function() {
				$('#button-reward-add').button('loading');
			},
			complete: function() {
				$('#button-reward-add').button('reset');
			},
			success: function(json) {
				$('.alert').remove();
				
				if (json['error']) {
					$('#pts-content > .pts-container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + '</div>');
				}
				
				if (json['success']) {
					$('#pts-content > .pts-container-fluid').prepend('<div class="alert pts-alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + '</div>');
					
					$('#button-reward-add').replaceWith('<button id="button-reward-remove" data-toggle="tooltip" title="{{ button_reward_remove }}" class="pts-btn pts-btn-danger pts-btn-xs"><i class="fa fa-minus-circle"></i></button>');
				}
			},
			error: function(xhr, ajaxOptions, thrownError) {
				alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
			}
		});
	});
	
	$(document).delegate('#button-reward-remove', 'click', function() {
		$.ajax({
			url: 'index.php?route=sale/order/removereward&order_id={{ order_id }}',
			type: 'post',
			dataType: 'json',
			beforeSend: function() {
				$('#button-reward-remove').button('loading');
			},
			complete: function() {
				$('#button-reward-remove').button('reset');
			},
			success: function(json) {
				$('.alert').remove();
				
				if (json['error']) {
					$('#pts-content > .pts-container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + '</div>');
				}
				
				if (json['success']) {
					$('#pts-content > .pts-container-fluid').prepend('<div class="alert pts-alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + '</div>');
					
					$('#button-reward-remove').replaceWith('<button id="button-reward-add" data-toggle="tooltip" title="{{ button_reward_add }}" class="pts-btn pts-btn-success pts-btn-xs"><i class="fa fa-plus-circle"></i></button>');
				}
			},
			error: function(xhr, ajaxOptions, thrownError) {
				alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
			}
		});
	});
	
	$(document).delegate('#button-commission-add', 'click', function() {
		$.ajax({
			url: 'index.php?route=sale/order/addcommission&order_id={{ order_id }}',
			type: 'post',
			dataType: 'json',
			beforeSend: function() {
				$('#button-commission-add').button('loading');
			},
			complete: function() {
				$('#button-commission-add').button('reset');
			},
			success: function(json) {
				$('.alert').remove();
				
				if (json['error']) {
					$('#pts-content > .pts-container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + '</div>');
				}
				
				if (json['success']) {
					$('#pts-content > .pts-container-fluid').prepend('<div class="alert pts-alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + '</div>');
					
					$('#button-commission-add').replaceWith('<button id="button-commission-remove" data-toggle="tooltip" title="{{ button_commission_remove }}" class="pts-btn pts-btn-danger pts-btn-xs"><i class="fa fa-minus-circle"></i></button>');
				}
			},
			error: function(xhr, ajaxOptions, thrownError) {
				alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
			}
		});
	});
	
	$(document).delegate('#button-commission-remove', 'click', function() {
		$.ajax({
			url: 'index.php?route=sale/order/removecommission&order_id={{ order_id }}',
			type: 'post',
			dataType: 'json',
			beforeSend: function() {
				$('#button-commission-remove').button('loading');
			},
			complete: function() {
				$('#button-commission-remove').button('reset');
			},
			success: function(json) {
				$('.alert').remove();
				
				if (json['error']) {
					$('#pts-content > .pts-container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + '</div>');
				}
				
				if (json['success']) {
					$('#pts-content > .pts-container-fluid').prepend('<div class="alert pts-alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + '</div>');
					
					$('#button-commission-remove').replaceWith('<button id="button-commission-add" data-toggle="tooltip" title="{{ button_commission_add }}" class="pts-btn pts-btn-success pts-btn-xs"><i class="fa fa-plus-circle"></i></button>');
				}
			},
			error: function(xhr, ajaxOptions, thrownError) {
				alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
			}
		});
	});
	
	
	$('#history').delegate('.pagination a', 'click', function(e) {
		e.preventDefault();
		
		$('#history').load(this.href);
	});
	
	$('#history').load('index.php?route=extension/account/purpletree_multivendor/sellerorder/historylist&order_id={{ order_id }}');
	{% if module_purpletree_multivendor_commission_status != admin_order_status_id %}
	$('#pts-button-history').on('click', function() {
		/*
			if (typeof verifyStatusChange == 'function'){
			if (verifyStatusChange() == false){
			return false;
			} else{
			addOrderInfo();
			}
			} else{
			addOrderInfo();
		}*/
		
		$.ajax({
			url: 'index.php?route=extension/account/purpletree_multivendor/sellerorder/history&order_id={{ order_id }}',
			type: 'post',
			dataType: 'json',
			data: 'order_status_id=' + encodeURIComponent($('select[name=\'order_status_id\']').val()) + '&notify=' + ($('input[name=\'notify\']').prop('checked') ? 1 : 0) + '&override=' + ($('input[name=\'override\']').prop('checked') ? 1 : 0) + '&append=' + ($('input[name=\'append\']').prop('checked') ? 1 : 0) + '&comment=' + encodeURIComponent($('textarea[name=\'comment\']').val()),
			cache: false,
			beforeSend: function() {
				$('#button-history').button('loading');
			},
			complete: function() {
				$('#button-history').button('reset');
			},
			success: function(json) {
				$('.alert').remove();
				
				if (json['error']) {
					$('#history').before('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
				}
				
				if (json['success']) {
					$('#history').load('index.php?route=extension/account/purpletree_multivendor/sellerorder/historylist&order_id={{ order_id }}');
					
					$('#history').before('<div class="alert pts-alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
					
					$('textarea[name=\'comment\']').val('');
				}
			},
			error: function(xhr, ajaxOptions, thrownError) {
				alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
			}
		});
	});
	{% endif %}
	
	function addOrderInfo(){
		var status_id = $('select[name="order_status_id"]').val();
		
		$.ajax({
			url: 'index.php?route=extension/openbay/addorderinfo&order_id={{ order_id }}&status_id=' + status_id,
			type: 'post',
			dataType: 'html',
			data: $(".openbay-data").serialize()
		});
	}
$('#cart').delegate('.btn-danger', 'click', function() {
	var node = this;

	$.ajax({
		url: '{{ catalog }}index.php?route=api/cart/remove&api_token={{ api_token }}&store_id=' + $('select[name=\'store_id\'] option:selected').val(),
		type: 'post',
		data: 'key=' + encodeURIComponent(this.value),
		dataType: 'json',
		crossDomain: true,
		beforeSend: function() {
			$(node).button('loading');
		},
		complete: function() {
			$(node).button('reset');
		},
		success: function(json) {
			$('.alert-dismissible, .text-danger').remove();

			// Check for errors
			if (json['error']) {
				$('#content > .container-fluid').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
			} else {
				// Refresh products, vouchers and totals
				$('#button-refresh').trigger('click');
			}
		},
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
	});
});

// Add all products to the cart using the api
$('#button-refresh').on('click', function() {
	$.ajax({
		url: '{{ catalog }}index.php?route=api/cart/products&api_token={{ api_token }}&store_id=' + $('select[name=\'store_id\'] option:selected').val(),
		dataType: 'json',
		crossDomain: true,
		beforeSend: function() {
			$('#button-refresh').button('loading');
		},
		complete: function() {
			$('#button-refresh').button('reset');
		},		
		success: function(json) {
			$('.alert-dismissible').remove();

			// Check for errors
			if (json['error']) {
				if (json['error']['warning']) {
					$('#content > .container-fluid').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
				}

				if (json['error']['stock']) {
					$('#content > .container-fluid').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error']['stock'] + '</div>');
				}

				if (json['error']['minimum']) {
					for (i in json['error']['minimum']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error']['minimum'][i] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
					}
				}
			}

			var shipping = false;

			html = '';

			if (json['products'].length) {
				for (i = 0; i < json['products'].length; i++) {
					product = json['products'][i];

					html += '<tr>';
					html += '  <td class="text-left">' + product['name'] + ' ' + (!product['stock'] ? '<span class="text-danger">***</span>' : '') + '<br />';
					html += '  <input type="hidden" name="product[' + i + '][product_id]" value="' + product['product_id'] + '" />';

					if (product['option']) {
						for (j = 0; j < product['option'].length; j++) {
							option = product['option'][j];

							html += '  - <small>' + option['name'] + ': ' + option['value'] + '</small><br />';

							if (option['type'] == 'select' || option['type'] == 'radio' || option['type'] == 'image') {
								html += '<input type="hidden" name="product[' + i + '][option][' + option['product_option_id'] + ']" value="' + option['product_option_value_id'] + '" />';
							}

							if (option['type'] == 'checkbox') {
								html += '<input type="hidden" name="product[' + i + '][option][' + option['product_option_id'] + '][]" value="' + option['product_option_value_id'] + '" />';
							}

							if (option['type'] == 'text' || option['type'] == 'textarea' || option['type'] == 'file' || option['type'] == 'date' || option['type'] == 'datetime' || option['type'] == 'time') {
								html += '<input type="hidden" name="product[' + i + '][option][' + option['product_option_id'] + ']" value="' + option['value'] + '" />';
							}
						}
					}

					html += '</td>';
					html += '  <td class="text-left">' + product['model'] + '</td>';
					html += '  <td class="text-right"><div class="input-group btn-block" style="max-width: 200px;"><input type="text" name="product[' + i + '][quantity]" value="' + product['quantity'] + '" class="form-control" /><span class="input-group-btn"><button type="button" data-toggle="tooltip" title="{{ button_refresh }}" data-loading-text="{{ text_loading }}" class="btn btn-primary"><i class="fa fa-refresh"></i></button></span></div></td>';
                    html += '  <td class="text-right">' + product['price'] + '</td>';
					html += '  <td class="text-right">' + product['total'] + '</td>';
					html += '  <td class="text-center" style="width: 3px;"><button type="button" value="' + product['cart_id'] + '" data-toggle="tooltip" title="{{ button_remove }}" data-loading-text="{{ text_loading }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
					html += '</tr>';

					if (product['shipping'] != 0) {
						shipping = true;
					}
				}
			}

			if (!shipping) {
				$('select[name=\'shipping_method\'] option').removeAttr('selected');
				$('select[name=\'shipping_method\']').prop('disabled', true);
				$('#button-shipping-method').prop('disabled', true);
			} else {
				$('select[name=\'shipping_method\']').prop('disabled', false);
				$('#button-shipping-method').prop('disabled', false);
			}

			if (json['vouchers'].length) {
				for (i in json['vouchers']) {
					voucher = json['vouchers'][i];

					html += '<tr>';
					html += '  <td class="text-left">' + voucher['description'];
                    html += '    <input type="hidden" name="voucher[' + i + '][code]" value="' + voucher['code'] + '" />';
					html += '    <input type="hidden" name="voucher[' + i + '][description]" value="' + voucher['description'] + '" />';
                    html += '    <input type="hidden" name="voucher[' + i + '][from_name]" value="' + voucher['from_name'] + '" />';
                    html += '    <input type="hidden" name="voucher[' + i + '][from_email]" value="' + voucher['from_email'] + '" />';
                    html += '    <input type="hidden" name="voucher[' + i + '][to_name]" value="' + voucher['to_name'] + '" />';
                    html += '    <input type="hidden" name="voucher[' + i + '][to_email]" value="' + voucher['to_email'] + '" />';
                    html += '    <input type="hidden" name="voucher[' + i + '][voucher_theme_id]" value="' + voucher['voucher_theme_id'] + '" />';
                    html += '    <input type="hidden" name="voucher[' + i + '][message]" value="' + voucher['message'] + '" />';
                    html += '    <input type="hidden" name="voucher[' + i + '][amount]" value="' + voucher['amount'] + '" />';
					html += '  </td>';
					html += '  <td class="text-left"></td>';
					html += '  <td class="text-right">1</td>';
					html += '  <td class="text-right">' + voucher['price'] + '</td>';
					html += '  <td class="text-right">' + voucher['price'] + '</td>';
					html += '  <td class="text-center" style="width: 3px;"><button type="button" value="' + voucher['code'] + '" data-toggle="tooltip" title="{{ button_remove }}" data-loading-text="{{ text_loading }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
					html += '</tr>';
				}
			}

			if (!json['products'].length && !json['vouchers'].length) {
				html += '<tr>';
				html += '  <td colspan="6" class="text-center">{{ text_no_results }}</td>';
				html += '</tr>';
			}

			$('#cart').html(html);

			// Totals
			html = '';

			if (json['products'].length) {
				for (i = 0; i < json['products'].length; i++) {
					product = json['products'][i];

					html += '<tr>';
					html += '  <td class="text-left">' + product['name'] + ' ' + (!product['stock'] ? '<span class="text-danger">***</span>' : '') + '<br />';

					if (product['option']) {
						for (j = 0; j < product['option'].length; j++) {
							option = product['option'][j];

							html += '  - <small>' + option['name'] + ': ' + option['value'] + '</small><br />';
						}
					}

					html += '  </td>';
					html += '  <td class="text-left">' + product['model'] + '</td>';
					html += '  <td class="text-right">' + product['quantity'] + '</td>';
					html += '  <td class="text-right">' + product['price'] + '</td>';
					html += '  <td class="text-right">' + product['total'] + '</td>';
					html += '</tr>';
				}
			}

			if (json['vouchers'].length) {
				for (i in json['vouchers']) {
					voucher = json['vouchers'][i];

					html += '<tr>';
					html += '  <td class="text-left">' + voucher['description'] + '</td>';
					html += '  <td class="text-left"></td>';
					html += '  <td class="text-right">1</td>';
					html += '  <td class="text-right">' + voucher['amount'] + '</td>';
					html += '  <td class="text-right">' + voucher['amount'] + '</td>';
					html += '</tr>';
				}
			}

			if (json['totals'].length) {
				for (i in json['totals']) {
					total = json['totals'][i];

					html += '<tr>';
					html += '  <td class="text-right" colspan="4">' + total['title'] + ':</td>';
					html += '  <td class="text-right">' + total['text'] + '</td>';
					html += '</tr>';
				}
			}

			if (!json['totals'].length && !json['products'].length && !json['vouchers'].length) {
				html += '<tr>';
				html += '  <td colspan="5" class="text-center">{{ text_no_results }}</td>';
				html += '</tr>';
			}

			$('#total').html(html);
		},
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
	});
});
//--></script> 
{{ footer }}